<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Submit Temuan - Biodiversity Atlas Indonesia</title>
    <link rel="stylesheet" href="css/submit-page.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">

    <!-- Leaflet CSS for map picker -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <!-- Admin Protection -->
    <script>
        // Protect page from admin access
        (function() {
            const currentUser = localStorage.getItem('currentUser');
            if (currentUser) {
                const user = JSON.parse(currentUser);
                if (user.role === 'admin') {
                    alert('⚠️ Halaman ini hanya untuk user biasa. Admin tidak dapat mengakses halaman Submit Temuan.');
                    window.location.href = 'admin-dashboard.html';
                }
            }
        })();
    </script>
</head>
<body>
    <div id="navbar-placeholder"></div>

    <!-- Submit Section -->
    <section class="submit-section">
        <div class="container">
            <div class="submit-container">
                <div class="submit-card">
                    <div class="submit-header">
                        <h1>Laporkan Temuan Anda</h1>
                        <p>Bantu kami mendokumentasikan keanekaragaman hayati Indonesia dengan melaporkan pengamatan Anda di lapangan</p>
                    </div>

                    <form class="submit-form" id="submitForm">
                        <!-- Image Upload -->
                        <div class="form-section">
                            <h3 class="form-section-title">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 1.5rem; height: 1.5rem;">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.774 48.774 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z" />
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0zM18.75 10.5h.008v.008h-.008V10.5z" />
                                </svg>
                                <span>Foto Pengamatan</span>
                            </h3>

                            <div class="form-group">
                                <label class="form-label form-label-required">Upload Foto</label>
                                <div class="image-upload-area" id="imageUploadArea">
                                    <div class="upload-icon">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 3rem; height: 3rem;">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.774 48.774 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z" />
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0zM18.75 10.5h.008v.008h-.008V10.5z" />
                                        </svg>
                                    </div>
                                    <div class="upload-text">Klik atau seret foto ke sini</div>
                                    <div class="upload-hint">Format: JPG, PNG (Max 5MB)</div>
                                </div>
                                <input type="file" id="imageInput" accept="image/*" style="display: none;">
                                
                                <div class="image-preview" id="imagePreview">
                                    <div class="preview-image-container">
                                        <img id="previewImage" class="preview-image" alt="Preview">
                                        <button type="button" class="remove-image-btn" id="removeImageBtn">×</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Species Information -->
                        <div class="form-section">
                            <h3 class="form-section-title">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 1.5rem; height: 1.5rem;">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.894 20.567L16.5 21.75l-.394-1.183a2.25 2.25 0 00-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 001.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 001.423 1.423l1.183.394-1.183.394a2.25 2.25 0 00-1.423 1.423z" />
                                </svg>
                                <span>Informasi Spesies</span>
                            </h3>

                            <!-- Species Input Mode Selection -->
                            <div class="form-group">
                                <label class="form-label">Metode Input Spesies</label>
                                <div class="radio-group">
                                    <label class="radio-option">
                                        <input type="radio" name="speciesInputMode" value="database" id="modeDatabase" checked>
                                        <span>Pilih dari Database</span>
                                    </label>
                                    <label class="radio-option">
                                        <input type="radio" name="speciesInputMode" value="manual" id="modeManual">
                                        <span>Input Spesies Baru (Belum Ada di Database)</span>
                                    </label>
                                </div>
                                <div class="form-hint">Pilih "Input Spesies Baru" jika spesies yang Anda temukan belum ada dalam database</div>
                            </div>

                            <!-- Database Mode -->
                            <div id="databaseModeFields">
                                <div class="form-group">
                                    <label class="form-label form-label-required" for="speciesInput">Cari Spesies</label>
                                    <div class="autocomplete-wrapper">
                                        <input
                                            type="text"
                                            id="speciesInput"
                                            class="form-input"
                                            placeholder="Ketik nama spesies..."
                                            autocomplete="off"
                                        >
                                        <input type="hidden" id="speciesId">
                                        <div class="autocomplete-dropdown" id="speciesDropdown"></div>
                                    </div>
                                    <div class="form-hint">Ketik untuk mencari spesies yang Anda temukan</div>
                                </div>
                            </div>

                            <!-- Manual Mode -->
                            <div id="manualModeFields" style="display: none;">
                                <div class="form-group">
                                    <label class="form-label form-label-required" for="speciesNameManual">Nama Spesies (Nama Umum)</label>
                                    <input
                                        type="text"
                                        id="speciesNameManual"
                                        class="form-input"
                                        placeholder="Contoh: Komodo, Orangutan Sumatera"
                                    >
                                    <div class="form-hint">Masukkan nama umum spesies yang Anda temukan</div>
                                </div>

                                <div class="form-group">
                                    <label class="form-label" for="scientificNameManual">Nama Ilmiah (Scientific Name)</label>
                                    <input
                                        type="text"
                                        id="scientificNameManual"
                                        class="form-input"
                                        placeholder="Contoh: Varanus komodoensis (opsional jika tidak tahu)"
                                    >
                                    <div class="form-hint">Masukkan nama ilmiah jika Anda mengetahuinya. Kosongkan jika tidak tahu, admin akan melengkapi</div>
                                </div>
                            </div>
                        </div>

                        <!-- Quick Facts -->
                        <div class="form-section">
                            <h3 class="form-section-title">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 1.5rem; height: 1.5rem;">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 3v11.25A2.25 2.25 0 006 16.5h2.25M3.75 3h-1.5m1.5 0h16.5m0 0h1.5m-1.5 0v11.25A2.25 2.25 0 0118 16.5h-2.25m-7.5 0h7.5m-7.5 0l-1 3m8.5-3l1 3m0 0l.5 1.5m-.5-1.5h-9.5m0 0l-.5 1.5M9 11.25v1.5M12 9v3.75m3-6v6" />
                                </svg>
                                <span>Fakta Singkat Spesies</span>
                            </h3>

                            <div class="form-group">
                                <label class="form-label form-label-required" for="speciesSize">Ukuran</label>
                                <input type="text" id="speciesSize" class="form-input" placeholder="Contoh: 2-3 meter panjang" required>
                                <div class="form-hint">Ukuran tubuh atau dimensi spesies yang diamati</div>
                            </div>

                            <div class="form-group">
                                <label class="form-label form-label-required" for="speciesDiet">Makanan</label>
                                <input type="text" id="speciesDiet" class="form-input" placeholder="Contoh: Karnivora - Rusa, babi hutan, tumbuhan" required>
                                <div class="form-hint">Jenis makanan yang dikonsumsi spesies</div>
                            </div>

                            <div class="form-group">
                                <label class="form-label form-label-required" for="speciesLifespan">Masa Hidup</label>
                                <input type="text" id="speciesLifespan" class="form-input" placeholder="Contoh: 30-50 tahun" required>
                                <div class="form-hint">Perkiraan umur atau masa hidup spesies</div>
                            </div>

                            <div class="form-group">
                                <label class="form-label form-label-required" for="speciesReproduction">Reproduksi</label>
                                <input type="text" id="speciesReproduction" class="form-input" placeholder="Contoh: Ovipar, 15-30 telur" required>
                                <div class="form-hint">Cara reproduksi dan jumlah keturunan</div>
                            </div>
                        </div>

                        <!-- Location -->
                        <div class="form-section">
                            <h3 class="form-section-title">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 1.5rem; height: 1.5rem;">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 10.5a3 3 0 11-6 0 3 3 0 016 0z" />
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1115 0z" />
                                </svg>
                                <span>Lokasi Pengamatan</span>
                            </h3>
                            
                            <div class="form-group">
                                <label class="form-label form-label-required">Pilih Lokasi di Peta</label>
                                <div id="mapPicker" class="map-picker"></div>
                                <div class="location-info">
                                    <div class="location-coords" id="locationCoords">
                                        Klik pada peta untuk menandai lokasi
                                    </div>
                                    <div class="location-status" id="locationStatus">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 1.25rem; height: 1.25rem;">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
                                        </svg>
                                        <span>Belum dipilih</span>
                                    </div>
                                </div>
                                <div class="form-hint">Klik pada peta untuk menandai lokasi pengamatan Anda</div>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="locationName">Nama Lokasi</label>
                                <input type="text" id="locationName" class="form-input" placeholder="Contoh: Taman Nasional Komodo">
                            </div>
                        </div>

                        <!-- Additional Notes -->
                        <div class="form-section">
                            <h3 class="form-section-title">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 1.5rem; height: 1.5rem;">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" />
                                </svg>
                                <span>Catatan Tambahan</span>
                            </h3>
                            
                            <div class="form-group">
                                <label class="form-label" for="observationNotes">Deskripsi Pengamatan</label>
                                <textarea id="observationNotes" class="form-textarea" placeholder="Jelaskan kondisi saat pengamatan, perilaku yang diamati, habitat sekitar, dll."></textarea>
                                <div class="form-hint">Informasi tambahan akan membantu validasi data</div>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="observationDate">Tanggal & Waktu Pengamatan</label>
                                <input type="datetime-local" id="observationDate" class="form-input">
                                <div class="form-hint">Pilih tanggal dan waktu saat Anda mengamati spesies ini</div>
                            </div>
                        </div>

                        <!-- Submit Actions -->
                        <div class="form-actions">
                            <button type="button" class="btn btn-secondary" id="resetBtn">
                                <span>Reset Form</span>
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <span>Submit Temuan</span>
                                <span class="btn-icon">→</span>
                            </button>
                        </div>

                        <!-- Success Message -->
                        <div class="success-message" id="successMessage">
                            <div class="success-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 4rem; height: 4rem;">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                            </div>
                            <div class="success-title">Temuan Berhasil Dikirim!</div>
                            <div class="success-text">Terima kasih atas kontribusi Anda. Temuan Anda akan diverifikasi oleh tim kami dalam 1-3 hari kerja.</div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <div id="footer-placeholder"></div>

    <script src="js/auth.js"></script>
    <script src="js/components-loader.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="js/script.js"></script>
    <script src="js/submit.js"></script>

    <!-- Login Protection -->
    <script>
        // Require login to access submit page
        if (!requireLogin()) {
            // Will redirect to login page if not logged in
        }
    </script>
</body>
</html>